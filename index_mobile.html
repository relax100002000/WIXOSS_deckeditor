<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/function.js"></script>
    <script src="js/card_info.js"></script>
    
    <title>WIXOSS Deck Builder Moblie</title>
    
    <style>
        /* === 全局設定 === */
        * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 10px; background-color: #f8f9fa; font-size: 16px; padding-bottom: 90px; }
        
        /* === 圖片樣式 === */
        img { 
            width: 100%; 
            height: auto; 
            aspect-ratio: 2/3; 
            object-fit: contain; 
            border-radius: 4px; 
            box-shadow: 1px 1px 3px rgba(0,0,0,0.2); 
            display: block; 
        }
        
        /* 橫向卡片專用樣式 */
        img.horizontal { aspect-ratio: 4/3; }

        /* 浮動預覽圖層 */
        #hover-overlay {
            position: fixed; display: none; z-index: 9999; pointer-events: none;
            background: rgba(0, 0, 0, 0.6); padding: 5px; border-radius: 8px;
            backdrop-filter: blur(2px); box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        #hover-overlay img { max-width: 320px; width: auto; height: auto; border-radius: 6px; box-shadow: none; display: block; aspect-ratio: auto; }

        /* Hover 效果 (僅限非觸控) */
        @media (hover: hover) {
            .deck-scroll-container img:hover, .main-deck-grid img:hover, #rdeck_table_wrapper img:hover {
                outline: 3px solid #007bff; cursor: pointer; filter: brightness(1.1); transition: all 0.1s;
            }
        }

        /* === UI 元件 (按鈕與輸入框) === */
        button, .custom-file-upload, select, input[type="text"] {
            height: 40px; 
            padding: 0 10px; 
            margin: 2px; 
            font-size: 14px;
            border: 1px solid #ddd; 
            border-radius: 6px; 
            background-color: white; 
            color: #333;
            vertical-align: middle;
        }

        /* [修正] 將 .custom-file-upload 加入此規則，確保字體粗細與對齊一致 */
        button, .custom-file-upload { 
            font-weight: 600; /* 加粗字體 */
            cursor: pointer; 
            transition: 0.2s; 
            white-space: nowrap;
            display: inline-flex; /* 確保內容垂直置中 */
            align-items: center; 
            justify-content: center;
        }
        button { font-weight: 600; cursor: pointer; transition: 0.2s; white-space: nowrap; }
        button:active { background-color: #e9ecef; }
        button.primary { background-color: #007bff; color: white; border: none; }
        button.danger { background-color: #dc3545; color: white; border: none; }
        label { display: inline-flex; align-items: center; margin: 4px 8px 4px 0; font-size: 0.9em; }
        input[type=checkbox] { transform: scale(1.2); margin-right: 6px; }
        .icon_img { height: 16px; width: auto; border: none !important; box-shadow: none; vertical-align: middle; margin: 0 2px; display: inline-block; aspect-ratio: auto; }

        /* === 佈局 === */
        .container { display: flex; flex-direction: column; gap: 15px; width: 100%; }
        .top-controls {
            background: white; padding: 8px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex; flex-wrap: wrap; gap: 5px; align-items: center; position: sticky; top: 0; z-index: 500;
        }

        /* === 圖表區 === */
        details summary {
            padding: 10px; background: #fff; font-weight: bold; cursor: pointer;
            list-style: none; display: flex; justify-content: space-between; align-items: center; user-select: none;
            border-radius: 8px; transition: background 0.2s;
        }
        details summary:hover { background-color: #f1f1f1; }
        details summary::-webkit-details-marker { display: none; }
        details summary::after { content: '+'; font-size: 1.5em; color: #888; font-weight: normal; line-height: 1; }
        details[open] summary { border-bottom: 1px solid #eee; border-radius: 8px 8px 0 0; }
        details[open] summary::after { content: '-'; }

        .charts-wrapper { background: white; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.03); overflow: hidden; }
        .charts-content { padding: 15px; }
        .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; }
        .chart-card { background: #fff; border: 1px solid #f0f0f0; border-radius: 8px; padding: 10px; display: flex; flex-direction: column; align-items: center; height: 200px; }
        .chart-title { font-size: 0.85em; font-weight: bold; color: #666; margin-bottom: 5px; width: 100%; text-align: left; border-bottom: 1px solid #f0f0f0; padding-bottom: 3px; }
        .chart-box { width: 100%; flex: 1; position: relative; min-height: 0; }

        /* === 牌組與搜尋結果共用區塊 === */
        .deck-section { 
            background: white; padding: 15px; border-radius: 10px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.03); width: 100%; 
            position: relative; z-index: 1;
        }
        
        .deck-header { 
            font-size: 1.05em; font-weight: bold; color: #444; 
            margin: 5px 0 5px 0; padding-left: 8px; border-left: 4px solid #666;
            background-color: #f9f9f9; padding: 5px 10px; border-radius: 4px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .deck-header.main, .deck-header.results { border-left-color: #007bff; background-color: #eef6ff; margin-top: 15px; }

        /* 上方捲動容器 (LRIG/Arts) - 固定寬度 */
        .deck-scroll-container {
            display: flex; overflow-x: auto; gap: 4px; padding: 5px; margin: 0; 
            -webkit-overflow-scrolling: touch; align-items: flex-start; min-height: 100px;
        }
        .deck-scroll-container img { 
            flex-shrink: 0; 
            width: 60px; /* 手機預設 */
            height: auto; 
            aspect-ratio: 2/3;
        }

        /* 網格系統 (Main Deck & Search Results) - 自適應寬度 */
        .grid-layout {
            display: grid; 
            gap: 4px; 
            width: 100%; 
            padding-top: 5px;
            align-items: start;
            grid-template-columns: repeat(5, 1fr); /* 手機預設 5 欄 */
        }

        /* Search Result Table Fix */
        #rdeck_table_wrapper table { width: 100%; }
        #rdeck_table_wrapper table td { display: block; }
        #rdeck_table_wrapper img { width: 100% !important; margin: 0 !important; }
        #rdeck_table_wrapper #larrow, #rdeck_table_wrapper #rarrow { display: none !important; }

        /* === 篩選器 === */
        .filters-section { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.03); width: 100%; }
        .filter-content { padding: 15px; background: #fcfcfc; }
        .filter-group { margin-bottom: 12px; border-bottom: 1px dashed #eee; padding-bottom: 12px; }

        /* === 分頁與彈窗 === */
        .pagination {
            position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(255,255,255,0.95);
            padding: 10px 20px; box-shadow: 0 -4px 15px rgba(0,0,0,0.1);
            display: flex; justify-content: space-between; align-items: center; z-index: 900; backdrop-filter: blur(2px);
        }
        .modal-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6);
            z-index: 3000; display: none; backdrop-filter: blur(2px);
        }
        .modal-content {
            background: white; width: 90%; max-width: 800px; height: 85%; margin: 5% auto;
            border-radius: 12px; padding: 20px; overflow-y: auto; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        #cardinformation {
            position: fixed !important; top: 50% !important; left: 50% !important; transform: translate(-50%, -50%) !important;
            margin: 0 !important; width: 90%; max-width: 400px; max-height: 85vh; background: white; border-radius: 12px;
            z-index: 2000; display: flex; flex-direction: column; padding: 15px; visibility: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.4);
        }

        /* === RWD 斷點設定 === */
        
        /* 平板/電腦 (>= 700px) */
        @media (min-width: 700px) {
            /* 主牌組與搜尋結果：10 欄 */
            .grid-layout { grid-template-columns: repeat(10, 1fr); }
            
            /* 上方捲動區：固定寬度 85px */
            .deck-scroll-container img { width: 85px; }
            .deck-scroll-container { min-height: 130px; }
        }
        
        @media (min-width: 1200px) {
            .container { display: grid; grid-template-columns: 300px 1fr; align-items: start; }
            .top-controls, .charts-wrapper { grid-column: 1 / -1; }
            .filters-section { position: sticky; top: 70px; }
        }
    </style>
</head>
<body>
    <div id="hover-overlay"><img id="hover-overlay-img" src="" alt="Preview"></div>

    <script>
        var page = 0, deckNamelist = [], sort_method = 0;
        var rdeckArr=[], pdeckArr=[], adeckArr=[], ldeckArr=[], sdeckArr=[], sdeckLBArr=[], sdecknoLBArr=[];
        var sdeck_l1=0, sdeck_l2=0, sdeck_l3=0, sdeck_spell=0;
        var sdeck_red=0, sdeck_blue=0, sdeck_green=0, sdeck_black=0, sdeck_white=0, sdeck_nocolor=0;
        var sdeck_burst=0, sdeck_no_burst=0;
        var sdeck_nostory=0, sdeck_dissona=0, sdeck_liberation=0, sdeck_struggle=0, sdeck_defense=0;
        var levelobj, colorobj, lbobj, storyobj;

        window.oldCommentEvent = window.commentEvent;
        window.commentEvent = function() {
            const textarea = document.getElementById('comment');
            if (textarea && typeof autoResize !== 'undefined') {
                textarea.addEventListener('input', autoResize);
                autoResize.call(textarea);
            }
        };

        function isHorizontalCard(card) {
            if (!card) return false;
            if (card[TYPE] == "ピース" || card[TYPE] == "ピース リレー" || card[TYPE] == "ピース クラフト") return true;
            var horizontalIDs = [
                "PR-Di035", "WX25-CD1-05", "WX25-CD1-06", "WX25-CD1-07", "WX25-CD1-08", "WX25-CD1-09", "WX25-CD1-10",
                "WX25-CP1-001", "WX25-CP1-002", "WX25-CP1-003", "WX25-CP1-004", "WX25-CP1-005", "WX25-CP1-006", "WX25-CP1-007", "WX25-CP1-008",
                "WX25-CP1-025", "WX25-CP1-026", "WX25-CP1-027", "WX25-CP1-028", "WX25-CP1-029", "WX25-CP1-030", "WX25-CP1-031", "WX25-CP1-032",
                "WX25-CP1-033", "WX25-CP1-034", "WX25-CP1-035", "WX25-CP1-036", "WX25-CP1-037"
            ];
            if (horizontalIDs.indexOf(card[ID]) !== -1) return true;
            return false;
        }

        window.showrdeck = function() {
            var i = 0, max = 0, ITEMS_PER_PAGE = 20;
            for(i = 0; i < ITEMS_PER_PAGE; i++) {
                $("#rdeck_" + i).attr("src", "img/empty.jpg").attr("alt", "").removeClass("horizontal").removeAttr("style").removeAttr("width").removeAttr("height");
            }
            if(rdeckArr.length < (page + 1) * ITEMS_PER_PAGE) max = rdeckArr.length % ITEMS_PER_PAGE || (rdeckArr.length > 0 ? ITEMS_PER_PAGE : 0);
            else max = ITEMS_PER_PAGE;

            for(i = 0; i < ITEMS_PER_PAGE; i++) {
                if(i < max) {
                    var cardIdx = page * ITEMS_PER_PAGE + i;
                    if (cardIdx < rdeckArr.length) {
                        var card = rdeckArr[cardIdx];
                        var imgObj = $("#rdeck_" + i);
                        imgObj.attr("src", card[SRC]).attr("alt", card[ID]);
                        if (isHorizontalCard(card)) imgObj.addClass("horizontal");
                        else imgObj.removeClass("horizontal");
                    }
                }
            }
            $("#totalCard").html(rdeckArr.length);
            if(rdeckArr.length == 0) $("#page").html("");
            else $("#page").html((page + 1) + " / " + Math.ceil(rdeckArr.length / ITEMS_PER_PAGE));
        }

        window.changePage = function(x) {
            var ITEMS_PER_PAGE = 20;
            if(rdeckArr.length <= ITEMS_PER_PAGE) return;
            if(x == "back") {
                if(page != 0) page--;
                else page = Math.ceil(rdeckArr.length / ITEMS_PER_PAGE) - 1;
            } else {
                if((page + 1) * ITEMS_PER_PAGE < rdeckArr.length) page++;
                else page = 0;
            }
            showrdeck();
        }

        $(document).ready(function() {
            if(typeof onLoading === 'function') onLoading();
            showrdeck(); 
            var fileInput = document.getElementById('fileinput');
            if(fileInput && typeof readSingleFile === 'function') fileInput.addEventListener('change', readSingleFile, false);
            
            const levelctx = document.getElementById('levelChart');
            if(levelctx) levelobj = new Chart(levelctx, { type: 'bar', data: { labels: ['L1', 'L2', 'L3', 'Spl'], datasets: [{ label: 'Count', data: [sdeck_l1, sdeck_l2, sdeck_l3, sdeck_spell], backgroundColor: ['#bdc3c7', '#95a5a6', '#7f8c8d', '#e74c3c'], borderRadius: 3 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } } });
            const colorctx = document.getElementById('colorChart');
            if(colorctx) colorobj = new Chart(colorctx, { type: 'doughnut', data: { labels: ['W', 'R', 'B', 'G', 'Bk', 'N'], datasets: [{ data: [sdeck_white, sdeck_red, sdeck_blue, sdeck_green, sdeck_black, sdeck_nocolor], backgroundColor: ['#f1c40f', '#e74c3c', '#3498db', '#2ecc71', '#9b59b6', '#ecf0f1'], borderWidth: 1 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { boxWidth: 8, font: { size: 9 } } } } } });
            const lbctx = document.getElementById('lbChart');
            if(lbctx) lbobj = new Chart(lbctx, { type: 'doughnut', data: { labels: ['Has LB', 'No LB'], datasets: [{ data: [sdeck_burst, sdeck_no_burst], backgroundColor: ['#f39c12', '#bdc3c7'] }] }, options: { responsive: true, maintainAspectRatio: false, cutout: '60%', plugins: { legend: { position: 'bottom', labels: { boxWidth: 8, font: { size: 9 } } } } } });
            const storyctx = document.getElementById('storyChart');
            if(storyctx) storyobj = new Chart(storyctx, { type: 'bar', data: { labels: ['無', 'D', '解', '闘', '防'], datasets: [{ data: [sdeck_nostory, sdeck_dissona, sdeck_liberation, sdeck_struggle, sdeck_defense], backgroundColor: ['#95a5a6', '#8e44ad', '#e74c3c', '#27ae60', '#f1c40f'], borderRadius: 3 }] }, options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { beginAtZero: true } } } });

            $(document).on('mouseenter', '.deck-scroll-container img, .grid-layout img', function(e) {
                if (window.matchMedia("(hover: none)").matches) return; 
                const src = $(this).attr('src');
                if(!src || src.indexOf('empty.jpg') !== -1) return;
                $('#hover-overlay-img').attr('src', src);
                $('#hover-overlay').show();
            });
            $(document).on('mousemove', function(e) {
                if($('#hover-overlay').is(':visible')) {
                    const overlay = $('#hover-overlay');
                    const offset = 20; 
                    let top = e.clientY + offset;
                    let left = e.clientX + offset;
                    if (e.clientX > window.innerWidth * 0.6) left = e.clientX - overlay.width() - offset;
                    if (e.clientY > window.innerHeight * 0.6) top = e.clientY - overlay.height() - offset;
                    overlay.css({ top: top + 'px', left: left + 'px' });
                }
            });
            $(document).on('mouseleave', '.deck-scroll-container img, .grid-layout img', function() {
                $('#hover-overlay').hide();
            });
        });
    </script>

    <div id='cardinformation'>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <h3 style="margin:0;">Card Details</h3>
            <button onclick="$('#cardinformation').css('visibility', 'hidden');" onmouseover="$('#cardinformation').css('visibility', 'hidden');" style="padding: 5px 12px;">✕</button>
        </div>
        <div style="flex: 1; overflow-y: auto;">
            <img id="big_pic" src="img/card_back.jpg" onclick="addDeck(this)" style="display:block; margin:0 auto 10px auto; max-height:280px;">
            <table id="infoTable"></table>
        </div>
        <button class="primary" style="margin-top:10px; width:100%;" onclick="addDeck(document.getElementById('big_pic'));">Add to Deck</button>
        <img id="cross" src="img/cancel_icon.png" style="display:none;">
    </div>

    <div class="top-controls">
        <select id="selectLang"><option value="JP">JP</option><option value="TW">TW</option></select>
        <select id="selectDeck" onchange="selectDeck();" style="flex: 1; min-width: 130px;"><option value="">-- Deck --</option></select>
        <button class="primary" onclick="customizeWindowEvent('code');">Menu</button>
        <button onclick="customizeWindowEvent('list');">List</button>
        <button class="danger" onclick="cleardeck()">Clear</button>
    </div>

    <div class="charts-wrapper">
        <details open>
            <summary>Deck Statistics</summary>
            <div class="charts-content">
                <div class="charts-grid">
                    <div class="chart-card"><div class="chart-title">Level Curve</div><div class="chart-box"><canvas id="levelChart"></canvas></div></div>
                    <div class="chart-card"><div class="chart-title">Color Ratio</div><div class="chart-box"><canvas id="colorChart"></canvas></div></div>
                    <div class="chart-card"><div class="chart-title">Burst Chance</div><div class="chart-box"><canvas id="lbChart"></canvas></div></div>
                    <div class="chart-card"><div class="chart-title">Class / Story</div><div class="chart-box"><canvas id="storyChart"></canvas></div></div>
                </div>
                <div id="counter" style="text-align: center; color: #666; font-size: 0.85em; margin-top: 5px;"></div>
            </div>
        </details>
    </div>

    <div class="container">
        <div class="filters-section">
            <details open>
                <summary>Filters & Search</summary>
                <div class="filter-content">
                    <div class="filter-group">
                        <input type="text" id="textsearch" placeholder="Card Name..." style="width: 100%;">
                        <div style="display:flex; gap:10px; margin-top:5px;">
                            <button class="primary" onclick="search();" style="flex:1;">Search</button>
                            <button onclick="checkall();" style="flex:1;">Select All</button>
                            <button onclick="uncheckall();" style="flex:1;">Reset</button>
                        </div>
                    </div>
                    <div class="filter-group">
                        <b>Type:</b><br>
                        <label><input type="checkbox" id="lrig" checked> ルリグ</label>
                        <label><input type="checkbox" id="assistlrig" checked> アシストルリグ</label>
                        <label><input type="checkbox" id="piece" checked> ピース</label>
                        <label><input type="checkbox" id="arts" checked> アーツ</label>
                        <label><input type="checkbox" id="signi" checked> シグニ</label>
                        <label><input type="checkbox" id="spell" checked> スペル</label>
                    </div>
                    <div class="filter-group">
                        <b>Level:</b><br>
                        <label><input type="checkbox" id="level0" checked> 0</label>
                        <label><input type="checkbox" id="level1" checked> 1</label>
                        <label><input type="checkbox" id="level2" checked> 2</label>
                        <label><input type="checkbox" id="level3" checked> 3</label>
                        <label><input type="checkbox" id="level4" checked> 4</label>
                    </div>
                    <div class="filter-group">
                        <b>Color:</b><br>
                        <label><input type="checkbox" id="white" checked> 白</label>
                        <label><input type="checkbox" id="red" checked> 赤</label>
                        <label><input type="checkbox" id="blue" checked> 青</label>
                        <label><input type="checkbox" id="green" checked> 緑</label>
                        <label><input type="checkbox" id="black" checked> 黒</label>
                        <label><input type="checkbox" id="nocolor" checked> 無</label>
                        <label><input type="checkbox" id="multicolor"> 多色</label>
                    </div>
                    <div class="filter-group">
                        <b>Phase:</b><br>
                        <label><input type="checkbox" id="mainphase" checked> メインフェイズ</label>
                        <label><input type="checkbox" id="attackphase" checked> アタックフェイズ</label>
                        <label><input type="checkbox" id="spellcutin" checked> スペルカットイン</label>
                    </div>
                    <div class="filter-group">
                        <b>LB:</b><br>
                        <label><input type="checkbox" id="islb" checked> LB有り</label>
                        <label><input type="checkbox" id="notlb" checked> LB無し</label>
                    </div>
                    <div class="filter-group">
                        <b>Dream Team:</b><br>
                        <label><input type="checkbox" id="dreamteam" checked><img style="aspect-ratio:0; height:18px; border-style:none; cursor: pointer" src="img/icon_txt_team.png"></img></label>
                        <label><input type="checkbox" id="no_dreamteam" checked><img style="aspect-ratio:0; height:18px; border-style:none; cursor: pointer" src="img/no_icon_txt_team.png"></img></label>
                    </div>
                    <div class="filter-group">
                        <select id="selectProduct" style="width:100%;">
                            <option value="0">--All Product--</option>
                            <option value="WX25-P2">[WX25-P2] 拡張パック「RESONANCE SELECTOR」</option>
                            <option value="WX25-P1">[WX25-P1] 拡張パック「PRIMAL SELECTOR」</option>
                            <option value="WX25-CP1">[WX25-CP1] 拡張パック「ブルーアーカイブ SELECTOR」</option>
                            <option value="WX25-CD1">[WX25-CD1] 構築済みデッキ ブルーアーカイブ</option>
                            <option value="WX24-P4">[WX24-P4] 拡張パック「FORTH SELECTOR」</option>
                            <option value="WX24-P3">[WX24-P3] 拡張パック「REVERSAL SELECTOR」</option>
                            <option value="WX24-P2">[WX24-P2] 拡張パック「loth SELECTOR」</option>
                            <option value="WX24-P1">[WX24-P1] 拡張パック「RECOLLECT SELECTOR」</option>
                            <option value="WX24-D5">[WX24-D5] 構築済みデッキ「BLACK ALT DESIRE」</option>
                            <option value="WX24-D4">[WX24-D4] 構築済みデッキ「GREEN ALT WANNA」</option>
                            <option value="WX24-D3">[WX24-D3] 構築済みデッキ「BLUE ALT APPLI」</option>
                            <option value="WX24-D2">[WX24-D2] 構築済みデッキ「RED ALT AMBITION」</option>
                            <option value="WX24-D1">[WX24-D1] 構築済みデッキ「WHITE ALT HOPE」</option>
                            <option value="WXDi-P16">[WXDi-P16] 拡張パック「LEGENDARY DIVA」</option>
                            <option value="WXDi-P15">[WXDi-P15] 拡張パック「DIVISIONS DIVA」</option>
                            <option value="WXDi-CP02">[WXDi-CP02] 拡張パック「ブルーアーカイブ DIVA」</option>
                            <option value="WXDi-P14">[WXDi-P14] 拡張パック「フェゾーネ DIVA with 電音部」</option>
                            <option value="WXDi-P13">[WXDi-P13] 拡張パック「CONCORD DIVA」</option>
                            <option value="WXDi-P12">[WXDi-P12] 拡張パック「DISSONANCE DIVA」</option>
                            <option value="WXDi-CP01">[WXDi-CP01] 拡張パック「にじさんじ DIVA」</option>
                            <option value="WXDi-D09">[WXDi-D09] 構築済みデッキ「SUPER DIVA DECK DOUBLE HEROINES -ピルルク＆ヒラナ-」</option>
                            <option value="WXDi-P11">[WXDi-P11] 拡張パック「REUNION DIVA」</option>
                            <option value="WXDi-P10">[WXDi-P10] 拡張パック「PRISMATIC DIVA」</option>
                            <option value="WXDi-P09">[WXDi-P09] 拡張パック「CONFLATED DIVA」</option>
                            <option value="WXDi-P08">[WXDi-P08] 拡張パック「SPREAD DIVA」</option>
                            <option value="WXDi-P07">[WXDi-P07] 拡張パック「WELCOME BACK DIVA ～Lostorage～」</option>
                            <option value="WXDi-P06">[WXDi-P06] 拡張パック「WELCOME BACK DIVA ～selector～」</option>
                            <option value="WXDi-D08">[WXDi-D08] 構築済みデッキ「DIVA DEBUT DECK WHITE HOPE」</option>
                            <option value="WXDi-P05">[WXDi-P05] 拡張パック「CURIOSITY DIVA」</option>
                            <option value="WXDi-P04">[WXDi-P04] 拡張パック「VERTEX DIVA」</option>
                            <option value="WXDi-D07">[WXDi-D07] 構築済みデッキ「TOP DIVA DECK D・X・M」</option>
                            <option value="WXDi-P03">[WXDi-P03] 拡張パック「STANDUP DIVA」</option>
                            <option value="WXDi-P02">[WXDi-P02] 拡張パック「CHANGING DIVA」</option>
                            <option value="WXDi-P01">[WXDi-P01] 拡張パック「GLOWING DIVA」</option>
                            <option value="WXDi-D06">[WXDi-D06] 構築済みデッキ「DIVA DEBUT DECK DIAGRAM」</option>
                            <option value="WXDi-D05">[WXDi-D05] 構築済みデッキ「DIVA DEBUT DECK うちゅうのはじまり」</option>
                            <option value="WXDi-D04">[WXDi-D04] 構築済みデッキ「DIVA DEBUT DECK Card Jockey」</option>
                            <option value="WXDi-D03">[WXDi-D03] 構築済みデッキ「DIVA DEBUT DECK No Limit」</option>
                            <option value="WXDi-P00">[WXDi-P00] 拡張パック「INTERLUDE DIVA」</option>
                            <option value="WXDi-D02">[WXDi-D02] 構築済みデッキ「DIVA DEBUT DECK にじさんじ ver.さんばか」</option>
                            <option value="WXDi-D01">[WXDi-D01] 構築済みデッキ「ANCIENT SURPRISE」</option>
                            <option value="PR-Di">PRカード</option>
                            <option value="SPDi">SPカード</option>
                        </select>
                        <select id="selectLRIG" style="width:100%; margin-top:5px;">
                            <option value="0">-- LRIG --</option>
                            <option value="アト">アト</option>
                            <option value="タウィル">タウィル</option>
                            <option value="ウムル">ウムル</option>
                            <option value="リゼ">リゼ</option>
                            <option value="美兎">美兎</option>
                            <option value="アンジュ">アンジュ</option>
                            <option value="とこ">とこ</option>
                            <option value="ヒラナ">ヒラナ</option>
                            <option value="アキノ">アキノ</option>
                            <option value="レイ">レイ</option>
                            <option value="LION">LION</option>
                            <option value="LOVIT">LOVIT</option>
                            <option value="WOLF">WOLF</option>
                            <option value="タマゴ">タマゴ</option>
                            <option value="ノヴァ">ノヴァ</option>
                            <option value="バン">バン</option>
                            <option value="ムジカ">ムジカ</option>
                            <option value="マドカ">マドカ</option>
                            <option value="サンガ">サンガ</option>
                            <option value="エクス">エクス</option>
                            <option value="デウス">デウス</option>
                            <option value="マキナ">マキナ</option>
                            <option value="みこみこ">みこみこ</option>
                            <option value="まほまほ">まほまほ</option>
                            <option value="ゆかゆか">ゆかゆか</option>
                            <option value="タマ">タマ</option>
                            <option value="花代">花代</option>
                            <option value="緑子">緑子</option>
                            <option value="ユヅキ">ユヅキ</option>
                            <option value="ピルルク">ピルルク</option>
                            <option value="ウリス">ウリス</option>
                            <option value="リル">リル</option>
                            <option value="ドーナ">ドーナ</option>
                            <option value="あや">あや</option>
                            <option value="エルドラ">エルドラ</option>
                            <option value="アン">アン</option>
                            <option value="イオナ">イオナ</option>
                            <option value="カーニバル">カーニバル</option>
                            <option value="レイラ">レイラ</option>
                            <option value="ママ">ママ</option>
                            <option value="メル">メル</option>
                            <option value="ナナシ">ナナシ</option>
                            <option value="グズ子">グズ子</option>
                            <option value="リメンバ">リメンバ</option>
                            <option value="ミルルン">ミルルン</option>
                            <option value="ハナレ">ハナレ</option>
                            <option value="サシェ">サシェ</option>
                            <option value="アイヤイ">アイヤイ</option>
                            <option value="アルフォウ">アルフォウ</option>
                            <option value="ミュウ">ミュウ</option>
                            <option value="夢限">夢限</option>
                            <option value="アズサ">アズサ</option>
                            <option value="ネル">ネル</option>
                            <option value="シロコ">シロコ</option>
                            <option value="ヒナ">ヒナ</option>
                            <option value="ホシノ">ホシノ</option>
                            <option value="サオリ">サオリ</option>
                            <option value="ミヤコ">ミヤコ</option>
                            <option value="ユカリ">ユカリ</option>
                            <option value="シュン">シュン</option>
                            <option value="補習授業部">補習授業部</option>
                            <option value="C&C">C&C</option>
                            <option value="対策委員会">対策委員会</option>
                            <option value="風紀委員会">風紀委員会</option>
                            <option value="アザエラ">アザエラ</option>
                            <option value="ガブリエラ">ガブリエラ</option>
                            <option value="ミカエラ">ミカエラ</option>
                            <option value="るう子">るう子</option>
                            <option value="あきら">あきら</option>
                            <option value="ひとえ">ひとえ</option>
                            <option value="ちより">ちより</option>
                            <option value="ヤミノ">ヤミノ</option>
                            <option value="ララ・ルー">ララ・ルー</option>
                            <option value="ソウイ">ソウイ</option>
                        </select>
                        <select id="selectType" style="width:100%; margin-top:5px;">
                            <option value="0">-- Type --</option>
                            <option value="奏像：天使">奏像：天使</option>
                            <option value="奏像：悪魔">奏像：悪魔</option>
                            <option value="奏像：美巧">奏像：美巧</option>
                            <option value="奏像：英知">奏像：英知</option>
                            <option value="奏像：武勇">奏像：武勇</option>
                            <option value="奏像：プリパラ">奏像：プリパラ</option>
                            <option value="奏武：アーム">奏武：アーム</option>
                            <option value="奏武：ウェポン">奏武：ウェポン</option>
                            <option value="奏武：遊具">奏武：遊具</option>
                            <option value="奏武：毒牙">奏武：毒牙</option>
                            <option value="奏武：トリック">奏武：トリック</option>
                            <option value="奏武：ブルアカ">奏武：ブルアカ</option>
                            <option value="奏羅：宝石">奏羅：宝石</option>
                            <option value="奏羅：植物">奏羅：植物</option>
                            <option value="奏羅：原子">奏羅：原子</option>
                            <option value="奏羅：宇宙">奏羅：宇宙</option>
                            <option value="奏羅：微菌">奏羅：微菌</option>
                            <option value="奏械：電機">奏械：電機</option>
                            <option value="奏械：古代兵器">奏械：古代兵器</option>
                            <option value="奏械：迷宮">奏械：迷宮</option>
                            <option value="奏械：調理">奏械：調理</option>
                            <option value="奏械：乗機">奏械：乗機</option>
                            <option value="奏械：バーチャル">奏械：バーチャル</option>
                            <option value="世怜音女学院">世怜音女学院</option>
                            <option value="奏械：電音部">奏械：電音部</option>
                            <option value="奏生：水獣">奏生：水獣</option>
                            <option value="奏生：空獣">奏生：空獣</option>
                            <option value="奏生：地獣">奏生：地獣</option>
                            <option value="奏生：龍獣">奏生：龍獣</option>
                            <option value="奏生：凶蟲">奏生：凶蟲</option>
                            <option value="奏生：怪異">奏生：怪異</option>
                            <option value="奏元">奏元</option>
                        </select>
                        <select id="selectFaction" style="width:100%; margin-top:5px;"><option value="0">-- Faction --</option><option value="解放派">解放派</option><option value="闘争派">闘争派</option><option value="防衛派">防衛派</option></select>
                        <div style="display:none;"><input type="checkbox" id="islb" checked><input type="checkbox" id="notlb" checked><input type="checkbox" id="mainphase" checked><input type="checkbox" id="attackphase" checked><input type="checkbox" id="spellcutin" checked><input type="checkbox" id="no_story" checked><input type="checkbox" id="dissona" checked><input type="checkbox" id="dreamteam" checked><input type="checkbox" id="no_dreamteam" checked></div>
                    </div>
                </div>
            </details>
        </div>

        <div style="display:flex; flex-direction:column; gap:15px; width:100%;">
            <div class="deck-section">
                <div class="deck-header">LRIG Deck</div>
                <div class="deck-scroll-container">
                    <img id="ldeck_0" src="img/empty.jpg" onclick="delDeck(this,0,ldeckArr)" oncontextmenu="addDeck(this); return false;">
                    <img id="ldeck_1" src="img/empty.jpg" onclick="delDeck(this,1,ldeckArr)" oncontextmenu="addDeck(this); return false;">
                    <img id="ldeck_2" src="img/empty.jpg" onclick="delDeck(this,2,ldeckArr)" oncontextmenu="addDeck(this); return false;">
                    <img id="ldeck_3" src="img/empty.jpg" onclick="delDeck(this,3,ldeckArr)" oncontextmenu="addDeck(this); return false;">
                    <img id="ldeck_4" src="img/empty.jpg" onclick="delDeck(this,4,ldeckArr)" oncontextmenu="addDeck(this); return false;">
                    <img id="ldeck_5" src="img/empty.jpg" onclick="delDeck(this,5,ldeckArr)" oncontextmenu="addDeck(this); return false;">
                    <img id="ldeck_6" src="img/empty.jpg" onclick="delDeck(this,6,ldeckArr)" oncontextmenu="addDeck(this); return false;">
                    <img id="ldeck_7" src="img/empty.jpg" onclick="delDeck(this,7,ldeckArr)" oncontextmenu="addDeck(this); return false;">
                    <img id="ldeck_8" src="img/empty.jpg" onclick="delDeck(this,8,ldeckArr)" oncontextmenu="addDeck(this); return false;">
                    <img id="ldeck_9" src="img/empty.jpg" onclick="delDeck(this,9,ldeckArr)" oncontextmenu="addDeck(this); return false;">
                </div>

                <div class="deck-header">Piece & Arts</div>
                <div class="deck-scroll-container">
                    <img id="pdeck_0" src="img/empty.jpg" onclick="delDeck(this,0,pdeckArr)" oncontextmenu="addDeck(this); return false;">
                    <img id="pdeck_1" src="img/empty.jpg" onclick="delDeck(this,1,pdeckArr)" oncontextmenu="addDeck(this); return false;">
                    <div style="border-right:1px solid #ddd; margin:0 5px; height: 100px;"></div>
                    <img id="adeck_0" src="img/empty.jpg" onclick="delDeck(this,0,adeckArr)" oncontextmenu="addDeck(this); return false;">
                    <img id="adeck_1" src="img/empty.jpg" onclick="delDeck(this,1,adeckArr)" oncontextmenu="addDeck(this); return false;">
                    <img id="adeck_2" src="img/empty.jpg" onclick="delDeck(this,2,adeckArr)" oncontextmenu="addDeck(this); return false;">
                    <img id="adeck_3" src="img/empty.jpg" onclick="delDeck(this,3,adeckArr)" oncontextmenu="addDeck(this); return false;">
                    <img id="adeck_4" src="img/empty.jpg" onclick="delDeck(this,4,adeckArr)" oncontextmenu="addDeck(this); return false;">
                    <img id="adeck_5" src="img/empty.jpg" onclick="delDeck(this,5,adeckArr)" oncontextmenu="addDeck(this); return false;">
                    <img id="adeck_6" src="img/empty.jpg" onclick="delDeck(this,6,adeckArr)" oncontextmenu="addDeck(this); return false;">
                    <img id="adeck_7" src="img/empty.jpg" onclick="delDeck(this,7,adeckArr)" oncontextmenu="addDeck(this); return false;">
                </div>

                <div class="deck-header main">
                    SIGNI Deck
                    <select id="selectSort" onchange="selectSort();" style="height:30px; font-size:0.8em; width:auto; margin:0;">
                        <option value=0>Level Sort</option><option value=1>LB Sort</option>
                    </select>
                </div>
                <div class="main-deck-grid grid-layout">
                    <script>
                    for(let i=0;i<40;i++) {
                        document.write(`<img id="sdeck_${i}" src="img/empty.jpg" onclick="delDeck(this,${i},sdeckArr)" oncontextmenu="addDeck(this); return false;">`);
                    }
                    </script>
                </div>
            </div>

            <div class="deck-section">
                <div class="deck-header results">
                    Search Results
                    <span style="font-size:0.9em; font-weight:normal;">Total: <span id="totalCard" style="color:#007bff">0</span></span>
                </div>
                <div id="rdeck_table_wrapper" class="grid-layout">
                    <script>
                        for(let i=0; i<20; i++) {
                            document.write(`<img id="rdeck_${i}" onclick="onTabletCardClick(this)" alt="">`);
                        }
                    </script>
                </div>
            </div>
        </div>
    </div>

    <div class="pagination">
        <button onclick="changePage('back')" style="flex:1; margin-right:10px;">&lt; Prev</button>
        <span id="page" style="font-weight:bold; color:#333;"></span>
        <button onclick="changePage('next')" style="flex:1; margin-left:10px;">Next &gt;</button>
    </div>

    <div id="window-container-code" class="modal-container">
        <div id="window-pop-code" class="modal-content" style="text-align:center;">
            <h3>Menu / Tools</h3>
            <div style="text-align:left;">Deck Title:</div>
            <input type="text" id="deckTitle" value="My Deck" style="width:100%;">
            <textarea id="textCode" style="width:100%; height:120px; margin-top:10px; border:1px solid #ccc; padding:5px; border-radius:6px;"></textarea>
            <div id="deckStr" style="color:green; height:20px; font-size:0.9em;"></div>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;">
                <button onclick="copyClipboard()">Copy Code</button>
                <button onclick="addDecklist()">Save to List</button>
                <button onclick="downloadBlob('', 'text/csv;charset=utf-8;')">Download CSV</button>
                <label class="custom-file-upload" style="text-align:center; cursor:pointer; width:auto; margin:4px 0;">Import CSV <input id="fileinput" type="file" style="display:none;"></label>
                <button onclick="downloadBlobopenbatoru('', '')" style="grid-column: span 2;">Export for Open!batoru</button>
                <button class="danger" onclick="resetDefault()">Reset All Deck</button>
                <button class="danger" onclick="resetComment()">Clear Comment</button>
            </div>
            <button onclick="$('#window-container-code').hide()" style="width:100%; margin-top:15px; background:#666; color:white;">Close</button>
        </div>
    </div>
    
    <div id="window-container-list" class="modal-container">
        <div id="window-pop-list" class="modal-content">
            <div style="display:flex; justify-content:space-between;"><h3>Card List</h3><button onclick="$('#window-container-list').hide()">Close</button></div>
            <div id="decklist" style="overflow-y:auto; height:90%;"></div>
        </div>
    </div>

    <div id="window-container" class="modal-container">
        <div id="window-pop" class="modal-content" style="width:100%; height:100%; max-width:none; margin:0; background:rgba(255,255,255,0.95);">
             <button onclick="$('#window-container').hide(); $('#hidden-view-layer').hide();" style="position:absolute; top:10px; right:10px; z-index:100;">Close</button>
             <div style="display:flex; flex-wrap:wrap; justify-content:center; gap:5px; padding-top:50px;"></div>
        </div>
    </div>
    
    <div style="display:none;">
        <img id="show_ldeck_0"><img id="show_ldeck_1"><img id="show_ldeck_2"><img id="show_ldeck_3"><img id="show_ldeck_4"><img id="show_ldeck_5"><img id="show_ldeck_6"><img id="show_ldeck_7"><img id="show_ldeck_8"><img id="show_ldeck_9"><img id="show_pdeck_0"><img id="show_pdeck_1">
    </div>
    <div id="hidden-view-layer" style="display:none;">
        <script>for(let i=0;i<40;i++)document.write(`<img id="show_sdeck_${i}">`)</script>
    </div>

    <script>
        function onTabletCardClick(img) {
            if(!img.alt) return;
            if(typeof onmouseShow === 'function') {
                var c = null;
                for(var i=0; i<cardData.length; i++) if(cardData[i][ID]==img.alt) { c=cardData[i]; break; }
                if(c) {
                    $("#big_pic").attr("src", c[SRC]).attr("alt", c[ID]);
                    showInfotable(c);
                }
                $("#cardinformation").css("visibility", "visible");
            }
        }
        window.oldOnMouseShow = window.onmouseShow;
        window.onmouseShow = function(x, source) {};
        function customizeWindowEvent(x) {
            if(x==='code') $('#window-container-code').show();
            else if(x==='list') { $('#window-container-list').show(); if(typeof showList==='function') showList(); }
            else if(x==='view') { if(typeof rearrange_ldeck==='function' && rearrange_ldeck()!==false) { $('#hidden-view-layer').show(); $('#window-container').show(); } }
        }
    </script>
</body>
</html>